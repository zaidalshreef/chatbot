<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot Interface</title>
    <!-- Include Tailwind CSS from CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.4/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      /* Scrollbar for WebKit browsers */
      #chatbot-msgs-container::-webkit-scrollbar {
        width: 8px;
      }

      #chatbot-msgs-container::-webkit-scrollbar-thumb {
        background-color: #4b5563; /* Dark Gray */
        border-radius: 8px;
      }

      #chatbot-msgs-container::-webkit-scrollbar-track {
        background-color: #1f2937; /* Darker Gray */
      }
    </style>
    <script>
      let isLoading = false;

      // Function to send a message to the chatbot and get a response
      async function sendMessageToChatbot(message) {
        const response = await fetch(
          "https://zaidalsharif.pythonanywhere.com/chat",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: message }),
          },
        );
        return await response.json();
      }

      // Function to handle the form submission
      async function handleFormSubmit(event) {
        event.preventDefault();

        // Check if already loading
        if (isLoading) return;

        const inputField = document.getElementById("chatbotInput");
        const message = inputField.value;

        // Check if the input is empty
        if (message === "") return;

        // Set loading state to true
        isLoading = true;

        // Disable the input and button during loading
        inputField.disabled = true;
        document.getElementById("sendButton").disabled = true;

        displayMessage(message, "user");
        inputField.value = ""; // Clear the input field

        // Display loading message
        const loadingMessage = "Loading...";
        displayMessage(loadingMessage, "bot");

        try {
          const response = await sendMessageToChatbot(message);
          // Replace the loading message with the actual response
          replaceMessage(loadingMessage, response.response);
        } catch (error) {
          console.error("Error fetching response:", error);
          // Handle the error appropriately, e.g., display an error message to the user
        } finally {
          // Reset loading state and enable the input and button
          isLoading = false;
          inputField.disabled = false;
          document.getElementById("sendButton").disabled = false;
        }
      }
      // Function to display a message in the chat interface
      function displayMessage(message, sender) {
        const messagesContainer = document.getElementById("messagesContainer");
        const messageDiv = document.createElement("div");
        messageDiv.classList.add(
          "flex",
          sender === "user" ? "justify-end" : "justify-start",
        );
        const messageBubble = document.createElement("div");
        messageBubble.classList.add(
          "rounded-2xl",
          "py-2",
          "px-4",
          "max-w-md",
          "lg:max-w-xl",
          sender === "user" ? "bg-purple-500" : "bg-gray-700",
        );
        messageBubble.textContent = message;
        messageDiv.appendChild(messageBubble);
        messagesContainer.appendChild(messageDiv);
      }
      function replaceMessage(loadingMessage, actualMessage) {
        const messagesContainer = document.getElementById("messagesContainer");
        const loadingMessageDiv = messagesContainer.lastChild;
        // Create a new div for the actual message
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("flex", "justify-start");
        const messageBubble = document.createElement("div");
        messageBubble.classList.add(
          "rounded-lg",
          "py-2",
          "px-4",
          "max-w-md",
          "lg:max-w-md",
          "bg-gray-700",
        );
        messageBubble.textContent = actualMessage;
        messageDiv.appendChild(messageBubble);

        // Replace the loading message with the actual message
        messagesContainer.replaceChild(messageDiv, loadingMessageDiv);
      }

      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("chatbotForm");
        form.addEventListener("submit", handleFormSubmit);
      });
    </script>
  </head>
  <body class="bg-gray-800 w-full h-screen flex items-center justify-center">
    <!-- Chatbot Container -->
    <div
      class="bg-gray-900 flex flex-col justify-between h-full text-white rounded-lg shadow-lg p-6 w-full md:w-3/4 lg:w-1/2"
    >
        <!-- Chatbot Header -->
        <div class="border-b flex gap-3 items-center border-gray-700 pb-4 mb-4">
          <div>
            <img
              src="images/image.png"
              alt="Chatbot Icon"
              class="inline-block w-10 h-10 rounded-full"
            />
          </div>
          <div>
            <h1 class="text-xl font-bold text-purple-400">THE CHATBOT</h1>
            <p class="text-gray-400 text-sm">Ask me anything!</p>
          </div>
        </div>

        <!-- Chatbot Messages -->
        <div id="chatbot-msgs-container" class="h-full overflow-y-auto">
          <div id="messagesContainer" class="h-full mr-3 space-y-4">
            <p id="startChatMessage" class="text-gray-400 text-center">
              Start a conversation with the AI!
            </p>
            <!-- Messages will be displayed here -->
          </div>
        </div>
      <!-- </div> -->
      <!-- Chatbot Input -->
      <div class="pt-4 mb-4">
        <form
          id="chatbotForm"
          class="flex px-2 bg-purple-500 rounded-full items-center gap-2"
        >
          <input
            id="chatbotInput"
            type="text"
            placeholder="Type your message..."
            class="flex-1 p-3 rounded-full bg-transparent text-white placeholder-gray-100 focus:outline-none"
          />
          <button
            id="sendButton"
            class="rounded-full w-9 h-9 flex items-center justify-center p-2 bg-purple-200"
            type="submit"
          >
            <img class="w-6" src="images/send.png" />
          </button>
        </form>
      </div>
    </div>
  </body>
</html>
